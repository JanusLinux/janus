# Maintainer: protonesso <nagakamira@gmail.com>

pkgname=filesystem
pkgver=20180616
pkgrel=1
pkgdesc="Filesystem layout and configuration files"
arch=('any')
url="https://januslinux.github.io/"
license=('MIT')
groups=('base')
source=('fstab'
	'group'
	'host.conf'
	'hostname'
	'hosts'
	'inittab'
	'interfaces'
	'issue'
	'motd'
	'os-release'
	'passwd'	
	'profile'
	'protocols'
	'rc.init'
	'rc.local'
	'rc.shutdown'
	'resolv.conf'
	'securetty'
	'services'
	'shadow'
	'shells'
	'sysctl.conf'
	'runsvdir-start'
	'pacstrap'
	'genfstab'
	'zzz'
	'screenoff'
	'alarmclock'
	'battery')
backup=('etc/fstab'
	'etc/group'
	'etc/host.conf'
	'etc/hostname'
	'etc/hosts'
	'etc/inittab'
	'etc/issue'
	'etc/motd'
	'etc/os-release'
	'etc/passwd'
	'etc/profile'
	'etc/protocols'
	'etc/rc.local'
	'etc/resolv.conf'
	'etc/securetty'
	'etc/services'
	'etc/shadow'
	'etc/shells'
	'etc/sysctl.conf'
	'etc/network/interfaces')

package() {
	cd $pkgdir

	for d in boot dev etc/{skel,service,profile.d} home mnt usr var opt srv/http run; do
		install -d -m755 $d
	done

	install -d -m555 proc
	install -d -m555 sys
	install -d -m0750 root
	install -d -m1777 tmp
	install -d -m555 -g 11 srv/ftp

	ln -s /proc/self/mounts $pkgdir/etc/mtab

	for f in fstab group host.conf hostname hosts issue inittab motd os-release passwd profile protocols resolv.conf securetty services shells sysctl.conf; do
		install -m644 $srcdir/$f $pkgdir/etc
	done

	for f in shadow; do
		install -m600 $srcdir/$f $pkgdir/etc
	done

	mkdir -p \
		$pkgdir/etc/network/if-down.d \
		$pkgdir/etc/network/if-post-down.d \
		$pkgdir/etc/network/if-post-up.d \
		$pkgdir/etc/network/if-pre-down.d \
		$pkgdir/etc/network/if-pre-up.d \
		$pkgdir/etc/network/if-up.d

	cp $srcdir/interfaces $pkgdir/etc/network/interfaces

	install -Dm0755 $srcdir/rc.local $pkgdir/etc/rc.local

	for d in cache local opt log/old lib/misc empty service; do
		install -d -m755 var/$d
	done

	install -d -m1777 var/{tmp,spool/mail}

	install -d -m775 -g 50 var/games
	ln -s spool/mail var/mail
	ln -s ../run var/run
	ln -s ../run/lock var/lock

	for d in bin include lib share/misc src; do
		install -d -m755 usr/$d
	done

	ln -s usr/lib lib

	ln -s usr/bin bin
	ln -s usr/bin sbin
	ln -s bin usr/sbin

	for d in bin etc games include lib man sbin share src; do
		install -d -m755 usr/local/$d
	done

	for f in rc.init rc.shutdown; do
		install -Dm0755 $srcdir/$f $pkgdir/usr/bin/$f
	done

	install -Dm0755 $srcdir/runsvdir-start $pkgdir/usr/bin/runsvdir-start
	install -Dm0755 $srcdir/genfstab $pkgdir/usr/bin/genfstab
	install -Dm0755 $srcdir/pacstrap $pkgdir/usr/bin/pacstrap
	install -Dm0755 $srcdir/zzz $pkgdir/usr/bin/zzz
	install -Dm0755 $srcdir/screenoff $pkgdir/usr/bin/screenoff
	install -Dm0755 $srcdir/alarmclock $pkgdir/usr/bin/alarmclock
	install -Dm0755 $srcdir/battery $pkgdir/usr/bin/battery
}
md5sums=('e33f6dfdd61978fcb3ddf1431286e05a'
         '803b8bc2eda2a2b8923fd896a1244839'
         '96156bec8e05de67384dc93e72bdc313'
         '19a86833023ec6d40d08fad62097ae5b'
         '0166671b0bfc53018c8d7a6ec53dfcb0'
         'c1cb21a6b1c54fb7ab0a3c367878513f'
         'dfbaf998badeda14a9daaf11c803b064'
         'bc3e35fcf44fb35f578fe8cd3b438346'
         'd41d8cd98f00b204e9800998ecf8427e'
         '5fb3ddb1186acdaa53c18cefbf4c2628'
         '1664376c8de23eacd92025a729b366f4'
         '2c79e1762978235e7b4a9ef595f6c029'
         'd46c8af3927f3c5f748e359871bdf236'
         'b3d51cec28d7d5e939d767faab436d46'
         '4a5e2182d2fc9970862d87f2c77b527f'
         'a2f1d502714475c6f35b11a6cc3669c9'
         '4d255e0ff7e8a38be5b26ad7f0fc9769'
         '078b0fa13037f9186c530ad054803eda'
         '9d39e51e6bd5a30168c26c57b66d2e37'
         'd3472d1b4c3b087221d92996d86100be'
         '636953b1898f58c6a0dabe45e93825f0'
         '42f05de922d047b9bb697500a39e0dc3'
         '6473f1fe99e36f2a70e0345e4e4b138e'
         'b51958396adece663ddf7d1aa4bb8bcb'
         '7add791064fdee57272ead354819b820'
         'b6bfe108600d3985dd2d8ba0090fe5f7'
         '21a1826a3502c93f2c724060d0e59130'
         '27dc52f221c4ab3b144625d7276403b4'
         'c4a6a286509b5683f2f2cffb8861f515')
