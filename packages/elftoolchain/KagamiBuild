# Description: BSD licensed ELF toolchain
# URL:         https://sourceforge.net/projects/elftoolchain/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  bmake
# Section:     devel

name=elftoolchain
version=0.7.1
snapshot=r3933
release=2
source=("https://github.com/ataraxialinux/storage/raw/master/elftoolchain-code-$snapshot-trunk.zip")

build() {
	filter-flags -fomit-frame-pointer

	cd "$SRC"/elftoolchain-code-$snapshot-trunk
	patch -Np1 -i "$STUFF"/elftoolchain/0001-fix-makefiles.patch
	patch -Np1 -i "$STUFF"/elftoolchain/0002-add-rpaths.patch
	patch -Np1 -i "$STUFF"/elftoolchain/0003-compile-statically.patch
	patch -Np1 -i "$STUFF"/elftoolchain/0004-add-support-for-STN_UNDEF.patch
	patch -Np1 -i "$STUFF"/elftoolchain/0005-fix-build-on-musl-libc.patch
	patch -Np1 -i "$STUFF"/elftoolchain/0006-remove-ar-ranlib-and-nm.patch

	mkdir -p common/sys
	cp "$STUFF"/include/sys/queue.h common/sys

	bmake WITH_TESTS=no
	bmake WITH_TESTS=no DESTDIR="$PKG" install

	rm -rf \
		"$PKG"/usr/lib \
		"$PKG"/usr/include
}
