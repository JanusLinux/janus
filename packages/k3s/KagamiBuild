# Description: Lightweight Kubernetes
# URL:         https://github.com/rancher/k3s
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  go
# Section:     virt

name=k3s
version=1.18.8+k3s1
release=1
source=("https://github.com/rancher/k3s/archive/v$version.tar.gz")

build() {
	export GOPATH="$SRC"
	export CGO_CFLAGS="$CFLAGS"
	export CGO_CXXFLAGS="$CXXFLAGS"
	export GOFLAGS="-buildmode=pie -trimpath -mod=readonly -modcacherw"

	cd "$SRC"

	mkdir -p github.com/rancher
	cp -a $name-${version/+/-} github.com/rancher/k3s

	cd "$SRC"/github.com/rancher/k3s
	go build $GOFLAGS -o k3s
	go build $GOFLAGS -o kubectl ./cmd/kubectl

	for i in k3s kubectl; do
		install -Dm755 $i "$PKG"/usr/bin/$i
	done
}
