#!/bin/sh

appendpath () {
    case ":$PATH:" in
        *:"$1":*)
            ;;
        *)
            PATH="${PATH:+$PATH:}$1"
    esac
}

appendpath '/usr/local/sbin'
appendpath '/usr/local/bin'
appendpath '/usr/bin'
unset appendpath

export PATH

dmesg -n 1

mount -t proc proc /proc
mount -t sysfs sysfs /sys
echo /sbin/mdev > /proc/sys/kernel/hotplug
mdev -s
mkdir -p /dev/pts /dev/shm
mount -t devpts devpts /dev/pts
mount -t tmpfs tmpfs /dev/shm

mount -o remount,ro /

fsck -ATa
if [ $? -eq 1 ]; then
	clear
	echo Filesystem errors exist, fix manually.
	sleep 15
	sh
	halt -r
fi

mount -o remount,rw /

swapon -a

mount -a

if [[ -f '/etc/hostname' ]]
then
	hostname -F /etc/hostname
else
	hostname localhost
fi

hwclock -u -s

sysctl -w -p /etc/sysctl.conf

ifup -a

if [ -x /etc/rc.local ]; then
	/etc/rc.local
fi

dmesg >/var/log/dmesg.log

clear
