# Description: The Linux kernel
# URL:         https://www.kernel.org/
# Maintainer:  protonesso, nagakamira at gmail dot com

name=linux
version=4.18.5
release=1
source=(https://cdn.kernel.org/pub/linux/kernel/v4.x/$name-$version.tar.xz)

build() {
	case $BARCH in
		x86_64)
			export XKARCH="x86_64"
			;;
		aarch64)
			export XKARCH="arm64"
			;;
		armv7hf)
			export XKARCH="arm"
			;;
		powerpc)
			export XKARCH="powerpc"
			;;
		powerpc64)
			export XKARCH="powerpc"
			;;
		powerpc64le)
			export XKARCH="powerpc"
			;;
		s390x)
			export XKARCH="s390"
			;;
	esac

	cd $name-$version
	unset LDFLAGS
	make mrproper

	# temp
	make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE menuconfig
	make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE
	make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE INSTALL_MOD_PATH=$PKG/usr modules_install

	mkdir -p $PKG/boot
	case $BARCH in
		aarch64)
			make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE INSTALL_DTBS_PATH=$PKG/boot/dtbs dtbs_install
			;;
		armv7hf)
			make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE INSTALL_DTBS_PATH=$PKG/boot/dtbs dtbs_install
			;;
	esac

	make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE INSTALL_PATH=$PKG/boot install
}
