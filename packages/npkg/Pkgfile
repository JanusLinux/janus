# Description: A set of utilities to manage software packages
# URL:         https://github.com/protonesso/npkg
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  libarchive

name=npkg
version=0.1.2
release=5
source=(https://github.com/protonesso/npkg/archive/$version.tar.gz
	clean-package
	pkgmk.conf
	pkgadd.conf)

build() {
	cd $name-$version
	make -f Makefile.static PREFIX=/usr DESTDIR=$PKG install

	install -Dm755 $SRC/clean-package $PKG/usr/bin

	rm -rf $PKG/etc/pkgmk.conf $PKG/etc/pkgadd.conf
	cp $SRC/pkgmk.conf $PKG/etc/pkgmk.conf
	cp $SRC/pkgadd.conf $PKG/etc/pkgadd.conf

	sed -i $PKG/etc/pkgmk.conf \
		-e "s|@BARCH[@]|$BARCH|g" \
		-e "s|@CFLAGS[@]|$CFLAGS|g" \
		-e "s|@CXXFLAGS[@]|$CXXFLAGS|g" \
		-e "s|@LDFLAGS[@]|$LDFLAGS|g" \
		-e "s|@GCCOPTS[@]|$GCCOPTS|g"

	clean-package $PKG
}
