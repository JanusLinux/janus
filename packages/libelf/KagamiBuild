# Description: Utilities to handle ELF object files and DWARF debugging information
# URL:         https://sourceware.org/elfutils/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  zlib bzip2 xz zstd libuargp
# Section:     devel

name=libelf
version=0.183
release=2
source=("http://sourceware.org/pub/elfutils/$version/elfutils-$version.tar.bz2")

build() {
	cd "$SRC"/elfutils-$version
	patch -Np1 -i "$STUFF"/libelf/0001-fix-build-on-clang-compiler.patch
	patch -Np1 -i "$STUFF"/libelf/0002-fix-build-on-musl-libc.patch
	patch -Np1 -i "$STUFF"/libelf/0003-enable-usage-of-internal-fts.patch

	autoreconf -fiv

	./configure $TOOLFLAGS \
		--prefix=/usr \
		--enable-deterministic-archives \
		--disable-debuginfod \
		--disable-libdebuginfod \
		--disable-nls \
		--disable-werror

	for lib in lib libelf libdwfl libdwelf libebl libcpu backends libdw; do
		make -C $lib
	done

	make -C libelf DESTDIR="$PKG" install
	make -C libdw DESTDIR="$PKG" install
	make -C libdwelf DESTDIR="$PKG" install
	make -C libdwfl DESTDIR="$PKG" install

	mkdir -p "$PKG"/usr/lib/pkgconfig
	install -Dm644 config/libelf.pc "$PKG"/usr/lib/pkgconfig
	install -Dm644 config/libdw.pc "$PKG"/usr/lib/pkgconfig
	install -Dm644 version.h "$PKG"/usr/include/elfutils
}
