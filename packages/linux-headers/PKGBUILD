# Maintainer: Protonesso <nagakamira@gmail.com>

pkgname=linux-headers
pkgver=4.15.2
pkgrel=1
pkgdesc="C standard library"
arch=('i686' 'x86_64' 'armv7h' 'aarch64')
url="http://www.musl-libc.org/"
license=('MIT')
groups=('basic')
depends=('linux-headers')
source=("https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-$pkgver.tar.xz")
md5sums=('SKIP')

build() {
        cd $srcdir/linux-$pkgver

	export BCONF="--prefix=/usr --libdir=/usr/lib --libexecdir=/usr/libexec --bindir=/usr/bin --sbindir=/usr/bin --sysconfdir=/etc --localstatedir=/var"

	use_crosscompile() {
		export PATH="$TOOLS/bin:$PATH"

		export BHOST="$(echo ${MACHTYPE} | sed -e 's/-[^-]*/-cross/')"

		[[ $arch == "i686" ]] && export BTARGET="i686-linux-musl" && export ARCH="i386"
		[[ $arch == "x86_64" ]] && export BTARGET="x86_64-linux-musl" && export ARCH="x86_64"
		[[ $arch == "armv7h" ]] && export BTARGET="arm-linux-musleabihf" && export ARCH="arm"
		[[ $arch == "aarch64" ]] && export BTARGET="aarch64-linux-musl" && export ARCH="arm64"

		export CROSS_COMPILE="$BTARGET-"
	}

	[[ $CROSSCOMPILE == "YES" ]] && use_crosscompile

        make mrproper
}

package() {
        cd $srcdir/$pkgname-$pkgver

	make INSTALL_HDR_PATH=$pkgdir/usr headers_install
	find $pkgdir/usr/include -name .install -or -name ..install.cmd | xargs rm -fv
}
