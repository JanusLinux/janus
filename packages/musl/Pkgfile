# Description: The standard C library
# URL:         http://www.musl-libc.org/
# Maintainer:  protonesso, nagakamira at gmail dot com

name=musl
version=1.1.19
release=1
source=(http://www.musl-libc.org/releases/$name-$version.tar.gz
	getconf.c
	getent.c
	iconv.c)

build() {
	cd $name-$version
	./configure \
		--prefix=/usr \
		--syslibdir=/usr/lib \
		--enable-optimize=size \
		--build=$(cc -dumpmachine)
	make
	make DESTDIR=$PKG install

	mkdir -p $PKG/usr/bin
	ln -sf ../lib/libc.so $PKG/usr/bin/ldd

	for file in getconf getent iconv; do
		gcc --sysroot=$PKG -I$PKG/usr/include $CFLAGS -no-pie -fno-PIE $LDFLAGS -static $SRC/${file}.c -o $PKG/usr/bin/$file
	done
	clean-package
}
