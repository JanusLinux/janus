# Description: Premier connectivity tool for remote login with the SSH protocol
# URL:         https://www.openssh.com/portable.html
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  openssl

name=openssh
version=7.8p1
release=1
source=(https://fastly.cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/$name-$version.tar.gz
	openssl-1.1.0.patch
	openssh)

build() {
	cd $name-$version
	patch -p1 -i $SRC/openssl-1.1.0.patch
	./configure \
		--prefix=/usr \
		--sysconfdir=/etc/ssh \
		--libexecdir=/usr/lib \
		--sbindir=/usr/bin \
		--with-default-path='/usr/local/sbin:/usr/local/bin:/usr/bin' \
		--with-mantype=man \
		--with-md5-passwords \
		--with-pid-dir=/run \
		--with-privsep-path=/var/empty \
		--with-privsep-user=nobody \
		--with-ssl-engine \
		--build=$(cc -dumpmachine)
	make
	make DESTDIR=$PKG install

	install -Dm755 $SRC/openssh $PKG/etc/sv/sshd/run

	clean-package $PKG
}
