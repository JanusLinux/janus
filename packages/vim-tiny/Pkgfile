# Description: Vi Improved, a highly configurable, improved version of the vi text editor
# URL:         https://www.vim.org/
# Maintainer:  nee-san, nagakamira at gmail dot com
# Depends on:  ncurses libelf

name=vim-tiny
version=8.1.0990
release=1
source=("https://github.com/vim/vim/archive/v$version.tar.gz")
BOOTSTRAP=yes

build() {
	cd "$SRC"/vim-$version

	export vim_cv_terminfo=yes
	export vim_cv_tgetent=zero
	export vim_cv_tty_group=world
	export vim_cv_tty_mode=0620
	export vim_cv_getcwd_broken=no
	export vim_cv_stat_ignores_slash=yes
	export vim_cv_memmove_handles_overlap=yes
	export ac_cv_sizeof_int=4
	export ac_cv_small_wchar_t=no
	export vim_cv_toupper_broken=no

	./configure $BUILDFLAGS \
		--prefix=/usr \
		--localstatedir=/var/lib/vim \
		--with-compiledby='januslinux' \
		--with-features=tiny \
		--with-tlib=ncurses \
		--without-x \
		--enable-gui=no \
		--enable-multibyte \
		--disable-acl \
		--disable-desktop-database-update \
		--disable-gpm \
		--disable-gtktest \
		--disable-icon-cache-update \
		--disable-netbeans \
		--disable-selinux
	make
	make DESTDIR="$PKG" install

	ln -sf vim "$PKG"/usr/bin/vi
}
