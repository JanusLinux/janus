# Description: Tools necessary to build programs
# URL:         https://www.gnu.org/software/binutils/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  zlib
# Section:     devel

name=binutils
version=2.35.1
release=1
source=("https://ftp.gnu.org/gnu/$name/$name-$version.tar.xz")

build() {
	local archconfig hashconfig build_targets install_targets

	case "$BARCH" in
		x86_64)	archconfig="--enable-targets=x86_64-pep" ;;
	esac

	case "$BARCH" in
		mips64|mips64el|mips|mipsel)	hashconfig="--enable-default-hash-style=sysv" ;;
		*)				hashconfig="--enable-default-hash-style=gnu"  ;;
	esac

	case "$BARCH" in
		riscv64)
			build_targets="all-ld all-gas"
			install_targets="install-ld install-gas"
			;;
		*)
			build_targets="all-gas"
			install_targets="install-gas"
			;;
	esac

	cd "$SRC"/$name-$version
	mkdir build
	cd build

	../configure $TOOLFLAGS $archconfig $hashconfig \
		--prefix=/usr \
		--with-bugurl="https://github.com/ataraxialinux/ataraxia/issues" \
		--with-pic \
		--with-system-zlib \
		--enable-64-bit-bfd \
		--enable-deterministic-archives \
		--enable-gold \
		--enable-lto \
		--enable-plugins \
		--enable-relro \
		--enable-shared \
		--enable-threads \
		--disable-nls \
		--disable-multilib \
		--disable-werror
	make tooldir=/usr $build_targets
	make tooldir=/usr DESTDIR="$PKG" $install_targets
}
