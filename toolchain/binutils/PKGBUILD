pkgname=binutils
pkgver=2.30
pkgrel=1
arch=('any')
source=("http://ftpmirror.gnu.org/gnu/$pkgname/$pkgname-$pkgver.tar.xz")

build() {
	cd $srcdir/$pkgname-$pkgver
	sed -i "/ac_cpp=/s/\$CPPFLAGS/\$CPPFLAGS -O2/" libiberty/configure
	mkdir build
	cd build
	AR="ar" AS="as" \
	../configure \
		--prefix= \
		--host=$XHOST \
		--target=$XTARGET \
		--with-sysroot=$ROOTFS \
		--with-lib-path="$ROOTFS/usr/lib:$ROOTFS/usr/local/lib" \
		--with-pic \
		--enable-deterministic-archives \
		--disable-multilib \
		--disable-nls \
		--disable-werror
	make configure-host
	make
}

package() {
	unset MAKEFLAGS
	cd $srcdir/$pkgname-$pkgver
	cd build
	make DESTDIR=$pkgdir install
}
