name=go
version=20171003
release=1
source=(https://dl.google.com/go/go1.4-bootstrap-$version.tar.gz)

build() {
	cd $name/src
	export GOOS=linux

	case "$BARCH" in
		x86_64)
			export GOARCH=amd64
			;;
		aarch64)
			export GOARCH=arm64
			;;
		armhf)
			export GOARCH=arm
			export GOARM=7
			;;
	esac

	export GOROOT_FINAL=$TOOLS/usr/lib/go

	./make.bash

	cd ..
	install -d $PKG/usr/bin $PKG/usr/lib/go
	cp -a bin pkg src lib misc api $PKG/usr/lib/go

	ln -sf ../lib/go/bin/go $PKG/usr/bin/go
	ln -sf ../lib/go/bin/gofmt $PKG/usr/bin/gofmt

	find $PKG/usr/lib/go/src -name "testdata" | sort -u | xargs rm -rf
}
