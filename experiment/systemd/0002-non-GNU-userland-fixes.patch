From c5b5c998c602d46bbc1fb45cbb1aed2de85bf243 Mon Sep 17 00:00:00 2001
From: Ishimoto Shinobu <nagakamira@gmail.com>
Date: Thu, 20 Aug 2020 18:47:11 +0300
Subject: [PATCH] non-GNU-userland-fixes

Signed-off-by: Ishimoto Shinobu <nagakamira@gmail.com>
---
 meson.build                 | 4 ----
 tools/meson-make-symlink.sh | 6 +++---
 units/meson-add-wants.sh    | 8 ++++----
 3 files changed, 7 insertions(+), 11 deletions(-)

diff --git a/meson.build b/meson.build
index dbbddb6..49e4486 100644
--- a/meson.build
+++ b/meson.build
@@ -600,10 +600,6 @@ endforeach
 
 conf.set_quoted('TELINIT', get_option('telinit-path'))
 
-if run_command('ln', '--relative', '--help').returncode() != 0
-        error('ln does not support --relative (added in coreutils 8.16)')
-endif
-
 ############################################################
 
 gperf = find_program('gperf')
diff --git a/tools/meson-make-symlink.sh b/tools/meson-make-symlink.sh
index cdd5214..e817754 100755
--- a/tools/meson-make-symlink.sh
+++ b/tools/meson-make-symlink.sh
@@ -4,9 +4,9 @@ set -eu
 # this is needed mostly because $DESTDIR is provided as a variable,
 # and we need to create the target directory...
 
-mkdir -vp "$(dirname "${DESTDIR:-}$2")"
+mkdir -p "$(dirname "${DESTDIR:-}$2")"
 if [ "$(dirname $1)" = . -o "$(dirname $1)" = .. ]; then
-    ln -vfs -T -- "$1" "${DESTDIR:-}$2"
+    ln -fs -- "$1" "${DESTDIR:-}$2"
 else
-    ln -vfs -T --relative -- "${DESTDIR:-}$1" "${DESTDIR:-}$2"
+    ln -fs -- "${DESTDIR:-}$1" "${DESTDIR:-}$2"
 fi
diff --git a/units/meson-add-wants.sh b/units/meson-add-wants.sh
index a483d75..ac53755 100755
--- a/units/meson-add-wants.sh
+++ b/units/meson-add-wants.sh
@@ -14,15 +14,15 @@ case "$target" in
         ;;
 esac
 
-unitpath="${DESTDIR:-}${unitdir}/${unit}"
+unitpath="${unitdir}/${unit}"
 
 case "$target" in
     */)
-        mkdir -vp -m 0755 "$dir"
+        mkdir -p -m 0755 "$dir"
         ;;
     *)
-        mkdir -vp -m 0755 "$(dirname "$dir")"
+        mkdir -p -m 0755 "$(dirname "$dir")"
         ;;
 esac
 
-ln -vfs --relative "$unitpath" "$dir"
+ln -fs "$unitpath" "$dir"
-- 
2.28.0

From 6fb6e09211dad3364501f05f922de8f32db21c07 Mon Sep 17 00:00:00 2001
From: Ishimoto Shinobu <nagakamira@gmail.com>
Date: Thu, 20 Aug 2020 18:51:22 +0300
Subject: [PATCH] fix

Signed-off-by: Ishimoto Shinobu <nagakamira@gmail.com>
---
 tools/meson-make-symlink.sh | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/meson-make-symlink.sh b/tools/meson-make-symlink.sh
index e817754..9ab07d5 100755
--- a/tools/meson-make-symlink.sh
+++ b/tools/meson-make-symlink.sh
@@ -8,5 +8,5 @@ mkdir -p "$(dirname "${DESTDIR:-}$2")"
 if [ "$(dirname $1)" = . -o "$(dirname $1)" = .. ]; then
     ln -fs -- "$1" "${DESTDIR:-}$2"
 else
-    ln -fs -- "${DESTDIR:-}$1" "${DESTDIR:-}$2"
+    ln -fs -- "$1" "${DESTDIR:-}$2"
 fi
-- 
2.28.0

