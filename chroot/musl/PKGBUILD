pkgname=chroot-musl
pkgver=1.1.20
pkgrel=1
arch=('x86_64' 'i586' 'aarch64')
source=(https://www.musl-libc.org/releases/musl-$pkgver.tar.gz
	0001-update-netinet-tcp.h-for-linux-v4.18.patch
	0002-update-netinet-udp.h-for-linux-v4.18.patch
	0003-add-AF_XDP-to-sys-socket.h-from-linux-v4.18.patch
	0004-add-SIGSYS-support-to-sys-signalfd.h-from-linux-v4.1.patch
	0005-add-TRAP_UNK-si_code-to-signal.h-from-linux-v4.18.patch
	0006-add-io_pgetevents-and-rseq-syscall-numbers-from-linu.patch
	0007-add-AT_MINSIGSTKSZ-to-elf.h-from-linux-v4.18.patch
	0008-add-NT_VMCOREDD-to-elf.h-from-linux-v4.18.patch)

prepare() {
	cd musl-$pkgver
	patch -Np1 -i $srcdir/0001-update-netinet-tcp.h-for-linux-v4.18.patch
	patch -Np1 -i $srcdir/0002-update-netinet-udp.h-for-linux-v4.18.patch
	patch -Np1 -i $srcdir/0003-add-AF_XDP-to-sys-socket.h-from-linux-v4.18.patch
	patch -Np1 -i $srcdir/0004-add-SIGSYS-support-to-sys-signalfd.h-from-linux-v4.1.patch
	patch -Np1 -i $srcdir/0005-add-TRAP_UNK-si_code-to-signal.h-from-linux-v4.18.patch
	patch -Np1 -i $srcdir/0006-add-io_pgetevents-and-rseq-syscall-numbers-from-linu.patch
	patch -Np1 -i $srcdir/0007-add-AT_MINSIGSTKSZ-to-elf.h-from-linux-v4.18.patch
	patch -Np1 -i $srcdir/0008-add-NT_VMCOREDD-to-elf.h-from-linux-v4.18.patch
}

build() {
	cd musl-$pkgver
	./configure \
		CROSS_COMPILE=$XTARGET- \
		--target=$XTARGET \
		--prefix=/tools \
		--syslibdir=/tools/lib
	make
}

package() {
	cd musl-$pkgver
	make DESTDIR=$pkgdir install
}
