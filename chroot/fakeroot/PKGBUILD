pkgname=chroot-fakeroot
pkgver=1.23
pkgrel=1
arch=('x86_64' 'x86' 'arm64' 'armv7l' 'armv5tel' 'ppc64le' 'ppc64' 'ppc')
source=("http://ftp.debian.org/debian/pool/main/f/fakeroot/fakeroot_${pkgver}.orig.tar.xz"
	'fakeroot-hide-dlsym-errors.patch'
	'fakeroot-no64.patch'
	'fakeroot-stdint.patch'
	'fakeroot-no-ldlibrarypath.patch'
	'xstatjunk.patch')

prepare() {
	cd "$srcdir"/fakeroot-$pkgver
	patch -Np1 -i "$srcdir"/fakeroot-hide-dlsym-errors.patch
	patch -Np1 -i "$srcdir"/fakeroot-no64.patch
	patch -Np1 -i "$srcdir"/fakeroot-stdint.patch
	patch -Np1 -i "$srcdir"/fakeroot-no-ldlibrarypath.patch
	patch -Np1 -i "$srcdir"/xstatjunk.patch

	./bootstrap
}

build() {
	export CFLAGS="-D_STAT_VER=0 $CFLAGS"

	cd "$srcdir"/fakeroot-$pkgver
	./configure \
		--prefix=/tools \
		--build=$XHOST \
		--host=$XTARGET
	make
}

package() {
	cd "$srcdir"/fakeroot-$pkgver
	make DESTDIR=$pkgdir install
}
