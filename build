#!/usr/bin/env bash
#
# The 'Marisa' build system
#
# Copyright (c) 2016-2021 Ataraxia Linux <ataraxialinux@protonmail.com>

# Permission to use, copy, modify, and/or distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.

# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

set -e

source core.functions

main() {
	check_for_root
	check_for_arch "$BARCH"
	parse_architecture "$BARCH"

	msg "Exporting variables"
	export_variables "$BARCH"
	export_cflags "$BARCH"

	msg "Preparing environment for build"
	make_environment

	msg "Building cross-toolchain for '${BARCH}' platform"
	emerge_host gettext-tiny
	emerge_host texinfo
	emerge_host m4
	emerge_host bison
	emerge_host flex
	emerge_host bc
	emerge_host kmod
	emerge_host gperf
	emerge_host python
	emerge_host samurai
	emerge_host meson
	emerge_host cmake
	emerge_host_target linux-headers
	emerge_host_target fortify-headers
	emerge_host musl-headers
	emerge_host binutils
	emerge_host llvm
	emerge_target -f musl
	emerge_host llvm-runtime
	emerge_host grub
	emerge_host slibtool
	emerge_host autoconf
	emerge_host automake
	emerge_host pkgconf
}

main "$@"

exit 0

